create database crm;

create table status(
id int primary key auto_increment,
name varchar(100) not null
);

create table roles(
id int primary key auto_increment,
name varchar(50) not null,
description varchar(100)
);

create table users(
id int primary key auto_increment,
email varchar(100) not null,
password varchar(100) not null,
fullname varchar(100) not null,
avatar varchar(100),
role_id int not null
);

create table project(
id int primary key auto_increment,
name varchar(255) not null,
startdate date,
enddate date,
leader int not null
);

create table task(
id int primary key auto_increment,
name varchar(255) not null,
startdate date,
enddate date,
statusid int not null,
projectid int not null,
userid int not null,
createuserid int not null
);

create table user_project(
projectid int not null,
userid int not null,
joindate date,
role varchar(100),
primary key(projectid, userid)
);

alter table users add constraint fk_users_roles foreign key(role_id) references roles(id);
alter table project add constraint fk_project_users foreign key(leader) references users(id);
alter table task add constraint fk_task_status foreign key(statusid) references status(id);
alter table task add constraint fk_task_project foreign key(projectid) references project(id);
alter table task add constraint fk_task_usersimpl foreign key(userid) references users(id);
alter table task add constraint fk_task_createuser foreign key(createuserid) references users(id);
alter table user_project add constraint fk_user_project_project foreign key(projectid) references project(id);
alter table user_project add constraint fk_user_project_user foreign key(userid) references users(id);

-- insert data for status table
insert into status(name) values('Đang tiến hành');
insert into status(name) values('Hoàn thành');

-- insert data for roles table
insert into roles(name, description) values('ROLE_ADMIN', 'Quản trị hệ thống');
insert into roles(name, description) values('ROLE_MANAGER', 'Quản lý dự án');
insert into roles(name, description) values('ROLE_USER', 'Nhân viên');

-- insert data for users table
insert into users(email, password, fullname, avatar, role_id) VALUES('tranngocanhh98@gmail.com', '$2a$12$qhJ9uwH61wwIHOtrANdK3eUdLlqcGE1IVWMfTucUFJ4/mcuRXlMSC', 'Trần Ngọc Anh', 'ngocanhh', 1);
insert into users(email, password, fullname, avatar, role_id) VALUES('quanlya@gmail.com', '$2a$12$0jqWqKKA8tqlMmd5g9gnMec6BzVVoR/MI5JsW4vlQbvZeHzO5NpTC', 'Quản lý a', 'quanlya', 2);
insert into users(email, password, fullname, avatar, role_id) VALUES('quanlyb@gmail.com', '$2a$12$vDeZRTscyCuzO8LCCWrKBu8krtH00uqYCTRByHFzHxSI4lAOZmJQ2', 'Quản lý b', 'quanlyb', 2);
insert into users(email, password, fullname, avatar, role_id) VALUES('nhanviena@gmail.com', '$2a$12$tD0nOMxrNOgH4zFnCSlz9eK4Xr6K5TqJNsAFhjctnzO2aXLWBJywa', 'Nhân viên a', 'nhanviena', 3);
insert into users(email, password, fullname, avatar, role_id) VALUES('nhanvienb@gmail.com', '$2a$12$3sq1KyWgivwLxv/vJladHOv75VL25gW1e3KduKKX6l9GAyfdF6bJK', 'Nhân viên b', 'nhanvienb', 3);
insert into users(email, password, fullname, avatar, role_id) VALUES('nhanvienc@gmail.com', '$2a$12$hz0EkZyu99ouU1gVhk3xo.h5hdDRNXzeQYxPHbIRBZruPUztCZ0QO', 'Nhân viên c', 'nhanvienc', 3);
insert into users(email, password, fullname, avatar, role_id) VALUES('nhanviend@gmail.com', '$2a$12$is/nBxnwvEVo6jUFuBIwY.Sb5bXXvEHNvumKo6Uv5/dlV0uKnp0H2', 'Nhân viên d', 'nhanviend', 3);

-- insert data for project table
insert into project(name, startdate, enddate, leader) VALUES('Dự án CRM', '2021-01-20', '2021-02-23', 2);
insert into project(name, startdate, enddate, leader) VALUES('Dự án a', '2021-02-08', '2021-03-24', 2);
insert into project(name, startdate, enddate, leader) VALUES('Dự án b', '2021-01-01', '2021-04-02', 7);
insert into project(name, startdate, enddate, leader) VALUES('Dự án c', '2021-04-17', '2021-09-21', 7);
insert into project(name, startdate, enddate, leader) VALUES('Dự án d', '2021-01-20', '2021-02-23', 2);

-- insert data for user_project table
insert into user_project values(1, 3, '2021-02-15', 'coder');
insert into user_project values(1, 4, '2021-02-24', 'coder');
insert into user_project values(3, 5, '2021-02-24', 'coder');
insert into user_project values(3, 6, '2021-02-24', 'coder');
insert into user_project values(4, 4, '2021-02-24', 'coder');
insert into user_project values(4, 6, '2021-02-24', 'coder');
insert into user_project values(5, 3, '2021-02-15', 'coder');
insert into user_project values(5, 5, '2021-02-15', 'coder');
insert into user_project values(3, 3, '2021-02-15', 'coder');
insert into user_project values(4, 5, '2021-02-15', 'coder');
insert into user_project values(2, 6, '2021-02-15', 'coder');







